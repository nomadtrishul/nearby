# Netlify Configuration File
# Documentation: https://docs.netlify.com/configure-builds/file-based-configuration/

[build]
  # Build command for Next.js
  # The @netlify/plugin-nextjs automatically handles the build process
  command = "npm run build"
  
  # Publish directory is automatically handled by the Next.js plugin
  # No need to specify it explicitly for Next.js projects

[build.environment]
  # Node.js version
  NODE_VERSION = "22"
  
  # Enable Next.js optimizations
  NEXT_TELEMETRY_DISABLED = "1"

# Image CDN Configuration
# Allows Netlify's Image CDN to process images from external domains
# This enables on-the-fly image transformations and optimizations
[images]
  remote_images = [
    "https://res.cloudinary.com/.*",
    "https://images.unsplash.com/.*"
  ]

# Headers Configuration
# These headers are applied at the CDN level for better performance
# They complement the headers defined in next.config.ts
[[headers]]
  for = "/*"
  [headers.values]
    # Security headers
    X-Frame-Options = "SAMEORIGIN"
    X-Content-Type-Options = "nosniff"
    X-XSS-Protection = "1; mode=block"
    Referrer-Policy = "origin-when-cross-origin"
    Permissions-Policy = "camera=(), microphone=(), geolocation=()"
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload"
    # Performance headers
    X-DNS-Prefetch-Control = "on"
    # Cache control for HTML pages
    Cache-Control = "public, max-age=3600, must-revalidate"

# Static assets caching (JS, CSS, images)
[[headers]]
  for = "/_next/static/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/images/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/_next/image*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/static/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/ads.txt"
  [headers.values]
    Cache-Control = "public, max-age=86400, must-revalidate"

[[headers]]
  for = "/robots.txt"
  [headers.values]
    Cache-Control = "public, max-age=86400, must-revalidate"

[[headers]]
  for = "/sitemap.xml"
  [headers.values]
    Cache-Control = "public, max-age=3600, must-revalidate"

# Redirects Configuration
# Add any URL redirects here for SEO and user experience
# Format: from = "old-path", to = "new-path", status = 301
# Example redirects (uncomment and modify as needed):
# [[redirects]]
#   from = "/old-page"
#   to = "/new-page"
#   status = 301
#   force = true

# SPA fallback for client-side routing (if needed)
# [[redirects]]
#   from = "/*"
#   to = "/index.html"
#   status = 200

# Canonical redirects
[[redirects]]
  from = "http://nearbypetcare.com/*"
  to = "https://nearbypetcare.com/:splat"
  status = 301
  force = true

[[redirects]]
  from = "http://www.nearbypetcare.com/*"
  to = "https://nearbypetcare.com/:splat"
  status = 301
  force = true

[[redirects]]
  from = "https://www.nearbypetcare.com/*"
  to = "https://nearbypetcare.com/:splat"
  status = 301
  force = true

[[redirects]]
  from = "/:path/"
  to = "/:path"
  status = 301
  force = true

[[redirects]]
  from = "/:path/:splat/"
  to = "/:path/:splat"
  status = 301
  force = true

# Plugin Configuration
# Netlify Next.js plugin is auto-detected, but you can configure it explicitly
[[plugins]]
  package = "@netlify/plugin-nextjs"

# Edge Functions (if you plan to use Netlify Edge Functions)
# [edge_functions]
#   directory = "netlify/edge-functions"

